<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Details - Movilar</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Custom Styles -->
    <link href="styles.css" rel="stylesheet">
    <!-- Icon -->
    <link rel="icon" type="image/png" href="favicon.png">
    
    <style>
        /* Movie Hero Section */
        .movie-hero {
            position: relative;
            min-height: 85vh;
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            margin-top: 0;
        }
        
        .movie-hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, rgba(0,0,0,0.9) 0%, rgba(0,0,0,0.7) 50%, rgba(0,0,0,0.4) 100%);
            z-index: 1;
        }
        
        .movie-hero-content {
            position: relative;
            z-index: 2;
            padding-top: 60px;
            padding-bottom: 60px;
        }
        
        .movie-poster-container {
            position: relative;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0,0,0,0.5);
            transition: transform 0.3s ease;
        }
        
        .movie-poster-container:hover {
            transform: scale(1.05);
        }
        
        .movie-poster {
            width: 100%;
            height: auto;
            border-radius: 15px;
        }
        
        .movie-title {
            font-size: 3rem;
            font-weight: 700;
            color: #ffffff;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            margin-bottom: 15px;
            line-height: 1.2;
        }
        
        .movie-tagline {
            font-size: 1.2rem;
            color: #1DB954;
            font-style: italic;
            margin-bottom: 20px;
            font-weight: 500;
        }
        
        .movie-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .meta-item {
            background: rgba(29, 185, 84, 0.2);
            padding: 8px 16px;
            border-radius: 20px;
            border: 1px solid #1DB954;
            color: #1DB954;
            font-weight: 500;
            font-size: 0.9rem;
        }
        
        .movie-overview {
            font-size: 1.1rem;
            line-height: 1.7;
            color: #e0e0e0;
            margin-bottom: 25px;
            text-align: justify;
        }
        
        .rating-badge {
            background: linear-gradient(45deg, #1DB954, #17a047);
            color: white;
            padding: 8px 16px;
            border-radius: 25px;
            font-weight: 600;
            font-size: 1rem;
            display: inline-block;
            margin-bottom: 15px;
        }
        
        /* Cast and Crew Section */
        .cast-crew-section {
            background: #0a0a0a;
            padding: 50px 0;
        }
        
        .person-card {
            background: #1a1a1a;
            border-radius: 10px;
            overflow: hidden;
            transition: all 0.3s ease;
            border: 1px solid #333;
            height: 100%;
        }
        
        .person-card:hover {
            transform: translateY(-10px);
            border-color: #1DB954;
            box-shadow: 0 15px 30px rgba(29, 185, 84, 0.3);
        }
        
        .person-image {
            width: 100%;
            height: 180px;
            object-fit: cover;
        }
        
        .person-info {
            padding: 12px;
            text-align: center;
        }
        
        .person-name {
            color: #ffffff;
            font-weight: 600;
            margin-bottom: 4px;
            font-size: 0.95rem;
        }
        
        .person-role {
            color: #1DB954;
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        /* Related Movies Section */
        .related-section {
            padding: 50px 0;
        }
        
        .related-section:nth-child(even) {
            background: #0a0a0a;
        }
        
        .section-title {
            color: #1DB954;
            font-weight: 700;
            text-align: center;
            margin-bottom: 35px;
            font-size: 2rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .related-movie-card {
            background: #1a1a1a;
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.3s ease;
            cursor: pointer;
            border: 1px solid #333;
            height: 100%;
            max-width: 250px;
            margin: 0 auto;
        }
        
        .related-movie-card:hover {
            transform: translateY(-10px);
            border-color: #1DB954;
            box-shadow: 0 15px 30px rgba(29, 185, 84, 0.3);
        }
        
        .related-movie-poster {
            width: 100%;
            height: 280px;
            object-fit: cover;
            transition: transform 0.3s ease;
        }
        
        .related-movie-card:hover .related-movie-poster {
            transform: scale(1.1);
        }
        
        .related-movie-info {
            padding: 15px;
        }
        
        .related-movie-title {
            color: #ffffff;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 1rem;
            line-height: 1.3;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .related-movie-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .related-movie-year {
            color: #1DB954;
            font-weight: 500;
        }
        
        .related-movie-rating {
            background: rgba(29, 185, 84, 0.2);
            color: #1DB954;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        /* Loading Animation */
        .loading-spinner {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 200px;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 3px solid #333;
            border-top: 3px solid #1DB954;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .movie-hero-content {
                padding-top: 40px;
                padding-bottom: 40px;
            }
            
            .movie-title {
                font-size: 2.2rem;
            }
            
            .movie-tagline {
                font-size: 1.1rem;
            }
            
            .movie-overview {
                font-size: 1rem;
            }
            
            .section-title {
                font-size: 1.7rem;
            }
            
            .related-movie-poster {
                height: 230px;
            }
            
            .person-image {
                height: 150px;
            }
        }
        
        @media (max-width: 576px) {
            .movie-hero-content {
                padding-top: 30px;
                padding-bottom: 30px;
            }
            
            .movie-title {
                font-size: 1.8rem;
            }
            
            .movie-tagline {
                font-size: 1rem;
            }
            
            .movie-overview {
                font-size: 0.95rem;
            }
            
            .section-title {
                font-size: 1.5rem;
            }
            
            .person-image {
                height: 130px;
            }
            
            .related-movie-poster {
                height: 200px;
            }
            
            .related-movie-info {
                padding: 12px;
            }
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-movilar fixed-top">
        <div class="container-fluid">
            <a class="navbar-logo" href="index.html">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-play-fill" viewBox="0 0 16 16">
                    <path d="m11.596 8.697-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393"/>
                </svg>
                Movilar
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavMovilar">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNavMovilar">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="browse.html">Browse</a></li>
                    <li class="nav-item"><a class="nav-link" href="search.html">Search</a></li>
                    <li class="nav-item"><a class="nav-link" href="similar.html">Find Similar</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Movie Hero Section -->
    <section class="movie-hero" id="movieHero">
        <div class="container movie-hero-content">
            <div class="row align-items-center">
                <div class="col-lg-4 col-md-5 mb-4 mb-md-0">
                    <div class="movie-poster-container">
                        <img id="moviePoster" class="movie-poster" src="" alt="Movie Poster">
                    </div>
                </div>
                <div class="col-lg-8 col-md-7">
                    <h1 class="movie-title" id="movieTitle">Loading...</h1>
                    <p class="movie-tagline" id="movieTagline"></p>
                    
                    <div class="rating-badge" id="movieRating">
                        <i class="bi bi-star-fill me-2"></i>
                        <span>Loading...</span>
                    </div>
                    
                    <div class="movie-meta" id="movieMeta">
                        <!-- Meta information will be populated here -->
                    </div>
                    
                    <p class="movie-overview" id="movieOverview">Loading movie details...</p>
                    
                    <div class="row mt-4">
                        <div class="col-md-6">
                            <h5 style="color: #1DB954; margin-bottom: 15px;">
                                <i class="bi bi-person-fill me-2"></i>Director
                            </h5>
                            <p id="movieDirector" style="color: #e0e0e0; font-size: 1.1rem;">Loading...</p>
                        </div>
                        <div class="col-md-6">
                            <h5 style="color: #1DB954; margin-bottom: 15px;">
                                <i class="bi bi-music-note me-2"></i>Genres
                            </h5>
                            <p id="movieGenres" style="color: #e0e0e0; font-size: 1.1rem;">Loading...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Cast Section -->
    <section class="cast-crew-section">
        <div class="container">
            <h2 class="section-title">
                <i class="bi bi-people-fill me-3"></i>Cast & Crew
            </h2>
            <div id="castContainer" class="row g-4">
                <!-- Cast members will be populated here -->
            </div>
        </div>
    </section>

    <!-- Similar Movies Section -->
    <section class="related-section">
        <div class="container">
            <h2 class="section-title">
                <i class="bi bi-shuffle me-3"></i>Similar Movies
            </h2>
            <div id="similarMoviesContainer" class="row g-4">
                <!-- Similar movies will be populated here -->
            </div>
        </div>
    </section>

    <!-- Same Actor Movies Section -->
    <section class="related-section">
        <div class="container">
            <h2 class="section-title">
                <i class="bi bi-person-video2 me-3"></i>More from the Same Actors
            </h2>
            <div id="sameActorMoviesContainer" class="row g-4">
                <!-- Same actor movies will be populated here -->
            </div>
        </div>
    </section>

    <!-- Same Director Movies Section -->
    <section class="related-section">
        <div class="container">
            <h2 class="section-title">
                <i class="bi bi-camera-reels me-3"></i>More from the Same Director
            </h2>
            <div id="sameDirectorMoviesContainer" class="row g-4">
                <!-- Same director movies will be populated here -->
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer-movilar text-center">
        <div class="container">
            <p style="font-weight: 600;">Designed by</p>
            <p>Adem Özyılmaz</p>
            <p>Melih Eren Mallı</p>
            <p>Muhammed Gökhan Perçem</p>
            <p>Muhammet Furkan Kaplan</p>
            <p style="font-weight: 600;">for the Web Technologies Class 2025 - Kocaeli University</p>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/main.js"></script>
    
    <script>
        // API Configuration
        const API_KEY = '8c45f976cf5bf09078e4ad738b6a2127';
        const BASE_URL = 'https://api.themoviedb.org/3';
        const IMG_BASE_URL = 'https://image.tmdb.org/t/p/w500';
        const BG_BASE_URL = 'https://image.tmdb.org/t/p/original';
        const PROFILE_BASE_URL = 'https://image.tmdb.org/t/p/w185';

        // Global variables
        let currentMovie = null;
        let movieCredits = null;
        let movieId = null;

        // Get movie ID from URL parameters
        function getMovieId() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('id');
        }

        // Fetch movie details
        async function fetchMovieDetails(id) {
            try {
                const response = await fetch(`${BASE_URL}/movie/${id}?api_key=${API_KEY}&language=en-US`);
                if (!response.ok) throw new Error('Movie not found');
                return await response.json();
            } catch (error) {
                console.error('Error fetching movie details:', error);
                return null;
            }
        }

        // Fetch movie credits
        async function fetchMovieCredits(id) {
            try {
                const response = await fetch(`${BASE_URL}/movie/${id}/credits?api_key=${API_KEY}`);
                if (!response.ok) throw new Error('Credits not found');
                return await response.json();
            } catch (error) {
                console.error('Error fetching movie credits:', error);
                return null;
            }
        }

        // Fetch similar movies
        async function fetchSimilarMovies(id) {
            try {
                const response = await fetch(`${BASE_URL}/movie/${id}/similar?api_key=${API_KEY}&language=en-US&page=1`);
                if (!response.ok) throw new Error('Similar movies not found');
                const data = await response.json();
                return data.results || [];
            } catch (error) {
                console.error('Error fetching similar movies:', error);
                return [];
            }
        }

        // Fetch movies by actor
        async function fetchMoviesByActor(actorId) {
            try {
                const response = await fetch(`${BASE_URL}/person/${actorId}/movie_credits?api_key=${API_KEY}&language=en-US`);
                if (!response.ok) throw new Error('Actor movies not found');
                const data = await response.json();
                return data.cast || [];
            } catch (error) {
                console.error('Error fetching actor movies:', error);
                return [];
            }
        }

        // Fetch movies by director
        async function fetchMoviesByDirector(directorId) {
            try {
                const response = await fetch(`${BASE_URL}/person/${directorId}/movie_credits?api_key=${API_KEY}&language=en-US`);
                if (!response.ok) throw new Error('Director movies not found');
                const data = await response.json();
                return data.crew ? data.crew.filter(movie => movie.job === 'Director') : [];
            } catch (error) {
                console.error('Error fetching director movies:', error);
                return [];
            }
        }

        // Create movie card HTML
        function createMovieCard(movie) {
            const posterUrl = movie.poster_path 
                ? `${IMG_BASE_URL}${movie.poster_path}` 
                : 'https://via.placeholder.com/500x750?text=No+Image';
            
            const year = movie.release_date ? movie.release_date.slice(0, 4) : 'N/A';
            const rating = movie.vote_average ? movie.vote_average.toFixed(1) : 'N/A';

            return `
                <div class="col-lg-3 col-md-4 col-sm-6">
                    <div class="related-movie-card" onclick="navigateToMovie(${movie.id})">
                        <img src="${posterUrl}" alt="${movie.title}" class="related-movie-poster" loading="lazy">
                        <div class="related-movie-info">
                            <h6 class="related-movie-title">${movie.title}</h6>
                            <div class="related-movie-meta">
                                <span class="related-movie-year">${year}</span>
                                <span class="related-movie-rating">
                                    <i class="bi bi-star-fill"></i> ${rating}
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Create cast member card HTML
        function createCastCard(person, isDirector = false) {
            const profileUrl = person.profile_path 
                ? `${PROFILE_BASE_URL}${person.profile_path}` 
                : 'https://via.placeholder.com/185x278?text=No+Image';
            
            const role = isDirector ? 'Director' : (person.character || person.job || 'Unknown');

            return `
                <div class="col-lg-2 col-md-3 col-sm-4 col-6">
                    <div class="person-card">
                        <img src="${profileUrl}" alt="${person.name}" class="person-image" loading="lazy">
                        <div class="person-info">
                            <div class="person-name">${person.name}</div>
                            <div class="person-role">${role}</div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Navigate to another movie
        function navigateToMovie(id) {
            window.location.href = `movie.html?id=${id}`;
        }

        // Display movie details
        function displayMovieDetails(movie) {
            try {
                // Set background image
                if (movie.backdrop_path) {
                    document.getElementById('movieHero').style.backgroundImage = 
                        `url('${BG_BASE_URL}${movie.backdrop_path}')`;
                }

                // Set poster
                const posterUrl = movie.poster_path 
                    ? `${IMG_BASE_URL}${movie.poster_path}` 
                    : 'https://via.placeholder.com/500x750?text=No+Image';
                document.getElementById('moviePoster').src = posterUrl;

                // Set basic info
                document.getElementById('movieTitle').textContent = movie.title || 'Unknown Title';
                document.getElementById('movieTagline').textContent = movie.tagline || '';
                document.getElementById('movieOverview').textContent = movie.overview || 'No overview available.';

                // Set rating
                const rating = movie.vote_average ? movie.vote_average.toFixed(1) : 'N/A';
                document.querySelector('#movieRating span').textContent = `${rating}/10`;

                // Set meta information
                const metaContainer = document.getElementById('movieMeta');
                metaContainer.innerHTML = '';

                if (movie.release_date) {
                    metaContainer.innerHTML += `<span class="meta-item"><i class="bi bi-calendar me-2"></i>${movie.release_date}</span>`;
                }

                if (movie.runtime) {
                    metaContainer.innerHTML += `<span class="meta-item"><i class="bi bi-clock me-2"></i>${movie.runtime} minutes</span>`;
                }

                if (movie.vote_count) {
                    metaContainer.innerHTML += `<span class="meta-item"><i class="bi bi-people me-2"></i>${movie.vote_count.toLocaleString()} votes</span>`;
                }

                if (movie.budget && movie.budget > 0) {
                    metaContainer.innerHTML += `<span class="meta-item"><i class="bi bi-currency-dollar me-2"></i>$${movie.budget.toLocaleString()}</span>`;
                }

                // Set genres
                const genres = movie.genres ? movie.genres.map(g => g.name).join(', ') : 'Unknown';
                document.getElementById('movieGenres').textContent = genres;
            } catch (error) {
                console.error('Error displaying movie details:', error);
            }
        }

        // Display cast and crew
        function displayCastAndCrew(credits) {
            try {
                const castContainer = document.getElementById('castContainer');
                castContainer.innerHTML = '';

                // Add director first
                const director = credits.crew.find(person => person.job === 'Director');
                if (director) {
                    document.getElementById('movieDirector').textContent = director.name;
                    castContainer.innerHTML += createCastCard(director, true);
                } else {
                    document.getElementById('movieDirector').textContent = 'Unknown';
                }

                // Add main cast members (limit to 11 to make 12 total with director)
                const mainCast = credits.cast.slice(0, 11);
                mainCast.forEach(person => {
                    castContainer.innerHTML += createCastCard(person);
                });
            } catch (error) {
                console.error('Error displaying cast and crew:', error);
            }
        }

        // Display related movies
        function displayRelatedMovies(movies, containerId, limit = 8) {
            try {
                const container = document.getElementById(containerId);
                
                if (!movies || movies.length === 0) {
                    container.innerHTML = `
                        <div class="col-12 text-center">
                            <p style="color: #666; font-size: 1.2rem;">No related movies found.</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = '';
                const moviesToShow = movies.slice(0, limit);
                
                moviesToShow.forEach(movie => {
                    container.innerHTML += createMovieCard(movie);
                });
            } catch (error) {
                console.error('Error displaying related movies:', error);
            }
        }

        // Show loading spinner
        function showLoading(containerId) {
            const container = document.getElementById(containerId);
            if (container) {
                container.innerHTML = `
                    <div class="col-12">
                        <div class="loading-spinner">
                            <div class="spinner"></div>
                        </div>
                    </div>
                `;
            }
        }

        // Load all movie data
        async function loadMovieData() {
            movieId = getMovieId();
            
            if (!movieId) {
                document.getElementById('movieTitle').textContent = 'Movie not found';
                document.getElementById('movieOverview').textContent = 'Please check the URL and try again.';
                return;
            }

            try {
                // Load basic movie details
                currentMovie = await fetchMovieDetails(movieId);
                if (currentMovie) {
                    displayMovieDetails(currentMovie);
                    document.title = `${currentMovie.title} - Movilar`;
                } else {
                    throw new Error('Movie not found');
                }

                // Load credits
                movieCredits = await fetchMovieCredits(movieId);
                if (movieCredits) {
                    displayCastAndCrew(movieCredits);
                }

                // Load similar movies
                showLoading('similarMoviesContainer');
                const similarMovies = await fetchSimilarMovies(movieId);
                displayRelatedMovies(similarMovies, 'similarMoviesContainer');

                // Load movies by same main actor
                if (movieCredits && movieCredits.cast.length > 0) {
                    showLoading('sameActorMoviesContainer');
                    const mainActor = movieCredits.cast[0];
                    const actorMovies = await fetchMoviesByActor(mainActor.id);
                    const filteredActorMovies = actorMovies.filter(movie => movie.id != movieId);
                    displayRelatedMovies(filteredActorMovies, 'sameActorMoviesContainer');
                } else {
                    displayRelatedMovies([], 'sameActorMoviesContainer');
                }

                // Load movies by same director
                if (movieCredits) {
                    const director = movieCredits.crew.find(person => person.job === 'Director');
                    if (director) {
                        showLoading('sameDirectorMoviesContainer');
                        const directorMovies = await fetchMoviesByDirector(director.id);
                        const filteredDirectorMovies = directorMovies.filter(movie => movie.id != movieId);
                        displayRelatedMovies(filteredDirectorMovies, 'sameDirectorMoviesContainer');
                    } else {
                        displayRelatedMovies([], 'sameDirectorMoviesContainer');
                    }
                } else {
                    displayRelatedMovies([], 'sameDirectorMoviesContainer');
                }

            } catch (error) {
                console.error('Error loading movie data:', error);
                document.getElementById('movieTitle').textContent = 'Error loading movie';
                document.getElementById('movieOverview').textContent = 'There was an error loading the movie details. Please try again later.';
            }
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', loadMovieData);
    </script>
</body>
</html>
