<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Browse Movies - Movilar</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Custom Styles -->
    <link href="styles.css" rel="stylesheet">
    <!-- Icon -->
    <link rel="icon" type="image/png" href="favicon.png">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-movilar fixed-top">
        <div class="container-fluid">
            <a class="navbar-logo" href="index.html">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-play-fill" viewBox="0 0 16 16">
                    <path d="m11.596 8.697-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393"/>
                </svg>
                Movilar
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavMovilar">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNavMovilar">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link active" href="browse.html">Browse</a></li>
                    <li class="nav-item"><a class="nav-link" href="search.html">Search</a></li>
                    <li class="nav-item"><a class="nav-link" href="similar.html">Find Similar</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <main>
        <!-- Mood-Based Discovery -->
        <section class="mood-section">
            <div class="container">
                <h2 class="text-center mb-5"><i class="bi bi-emoji-smile me-3"></i>What's Your Mood?</h2>
                <div class="row g-4 mb-5">
                    <div class="col-md-3 col-sm-6">
                        <div class="mood-card" data-mood="happy">
                            <i class="bi bi-emoji-laughing"></i>
                            <h4>Happy</h4>
                            <p>Comedy & Feel-Good Movies</p>
                        </div>
                    </div>
                    <div class="col-md-3 col-sm-6">
                        <div class="mood-card" data-mood="exciting">
                            <i class="bi bi-lightning-charge"></i>
                            <h4>Exciting</h4>
                            <p>Action & Thriller Movies</p>
                        </div>
                    </div>
                    <div class="col-md-3 col-sm-6">
                        <div class="mood-card" data-mood="romantic">
                            <i class="bi bi-heart"></i>
                            <h4>Romantic</h4>
                            <p>Romance & Drama Movies</p>
                        </div>
                    </div>
                    <div class="col-md-3 col-sm-6">
                        <div class="mood-card" data-mood="thoughtful">
                            <i class="bi bi-lightbulb"></i>
                            <h4>Thoughtful</h4>
                            <p>Drama & Mystery Movies</p>
                        </div>
                    </div>
                </div>
                
                <!-- Mood Movies Section -->
                <div id="moodMoviesSection" style="display: none;">
                    <h3 id="moodTitle" class="text-center mb-4"></h3>
                    <div id="moodMovies" class="row g-4"></div>
                    <div class="text-center mt-4">
                        <button class="btn btn-movilar-outline" id="loadMoreMood">
                            <i class="bi bi-plus-circle me-2"></i>Load More
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Trending This Week -->
        <section class="trending-section">
            <div class="container">
                <h2 class="text-center mb-5"><i class="bi bi-fire me-3"></i>Trending This Week</h2>
                <div id="trendingMovies" class="row g-4"></div>
                <div class="text-center mt-4">
                    <button class="btn btn-movilar-outline" id="loadMoreTrending">
                        <i class="bi bi-plus-circle me-2"></i>Load More
                    </button>
                </div>
            </div>
        </section>

        <!-- All-Time Favorites -->
        <section class="classics-section">
            <div class="container">
                <h2 class="text-center mb-5"><i class="bi bi-star me-3"></i>All-Time Classics</h2>
                <div id="classicMovies" class="row g-4"></div>
                <div class="text-center mt-4">
                    <button class="btn btn-movilar-outline" id="loadMoreClassics">
                        <i class="bi bi-plus-circle me-2"></i>Load More
                    </button>
                </div>
            </div>
        </section>

        <!-- Popular by Genre -->
        <section class="genre-section">
            <div class="container">
                <h2 class="text-center mb-5">
                    <i class="bi bi-collection me-3"></i>Browse by Genre
                </h2>
                <div class="genre-tabs mb-4">
                    <div class="row g-2">
                        <div class="col-lg-2 col-md-3 col-sm-4 col-6">
                            <button class="btn genre-btn active w-100" data-genre="28">Action</button>
                        </div>
                        <div class="col-lg-2 col-md-3 col-sm-4 col-6">
                            <button class="btn genre-btn w-100" data-genre="35">Comedy</button>
                        </div>
                        <div class="col-lg-2 col-md-3 col-sm-4 col-6">
                            <button class="btn genre-btn w-100" data-genre="18">Drama</button>
                        </div>
                        <div class="col-lg-2 col-md-3 col-sm-4 col-6">
                            <button class="btn genre-btn w-100" data-genre="27">Horror</button>
                        </div>
                        <div class="col-lg-2 col-md-3 col-sm-4 col-6">
                            <button class="btn genre-btn w-100" data-genre="10749">Romance</button>
                        </div>
                        <div class="col-lg-2 col-md-3 col-sm-4 col-6">
                            <button class="btn genre-btn w-100" data-genre="878">Sci-Fi</button>
                        </div>
                    </div>
                </div>
                <div id="genreMovies" class="row g-4"></div>
                <div class="text-center mt-4">
                    <button class="btn btn-movilar-outline" id="loadMoreGenre">
                        <i class="bi bi-plus-circle me-2"></i>Load More
                    </button>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer-movilar text-center">
        <div class="container">
            <p style="font-weight: 600;">Designed by</p>
            <p>Adem Özyılmaz</p>
            <p>Melih Eren Mallı</p>
            <p>Muhammed Gökhan Perçem</p>
            <p>Muhammet Furkan Kaplan</p>
            <p style="font-weight: 600;">for the Web Technologies Class 2025 - Kocaeli University</p>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/main.js"></script>
    <script>
        const API_KEY = '8c45f976cf5bf09078e4ad738b6a2127';
        const BASE_URL = 'https://api.themoviedb.org/3';
        const IMG_BASE_URL = 'https://image.tmdb.org/t/p/w500';

        let currentMoodPage = 1;
        let currentTrendingPage = 1;
        let currentClassicsPage = 1;
        let currentGenrePage = 1;
        let currentMood = '';
        let currentGenre = '28';

        // Mood mappings to genres
        const moodToGenres = {
            happy: [35, 16, 10751], // Comedy, Animation, Family
            exciting: [28, 53, 878], // Action, Thriller, Sci-Fi
            romantic: [10749, 18, 35], // Romance, Drama, Comedy
            thoughtful: [18, 9648, 99] // Drama, Mystery, Documentary
        };

        // Create movie card
        function createMovieCard(movie) {
            const posterUrl = movie.poster_path 
                ? `${IMG_BASE_URL}${movie.poster_path}` 
                : 'https://via.placeholder.com/500x750?text=No+Image';
            
            const rating = movie.vote_average ? movie.vote_average.toFixed(1) : 'N/A';
            const year = movie.release_date ? movie.release_date.slice(0, 4) : 'N/A';

            return `
                <div class="col-md-3 col-sm-6">
                    <div class="movie-card" onclick="openMovieDetail(${movie.id})">
                        <img src="${posterUrl}" alt="${movie.title}" loading="lazy">
                        <div class="movie-info">
                            <h6 class="movie-title">${movie.title}</h6>
                            <small class="movie-year">Year: ${year}</small><br>
                            <small class="movie-rating">TMDB: ${rating}</small>
                        </div>
                    </div>
                </div>
            `;
        }

        // Open movie detail page
        function openMovieDetail(movieId) {
            window.location.href = `movie.html?id=${movieId}`;
        }

        // Fetch movies by mood
        async function fetchMoodMovies(mood, page = 1) {
            const genres = moodToGenres[mood].join(',');
            const url = `${BASE_URL}/discover/movie?api_key=${API_KEY}&with_genres=${genres}&sort_by=popularity.desc&page=${page}&vote_count.gte=100`;
            
            try {
                const response = await fetch(url);
                const data = await response.json();
                return data.results || [];
            } catch (error) {
                console.error('Error fetching mood movies:', error);
                return [];
            }
        }

        // Fetch trending movies
        async function fetchTrendingMovies(page = 1) {
            const url = `${BASE_URL}/trending/movie/week?api_key=${API_KEY}&page=${page}`;
            
            try {
                const response = await fetch(url);
                const data = await response.json();
                return data.results || [];
            } catch (error) {
                console.error('Error fetching trending movies:', error);
                return [];
            }
        }

        // Fetch classic movies (high rated, older movies)
        async function fetchClassicMovies(page = 1) {
            const url = `${BASE_URL}/discover/movie?api_key=${API_KEY}&sort_by=vote_average.desc&vote_count.gte=1000&primary_release_date.lte=2010-12-31&page=${page}`;
            
            try {
                const response = await fetch(url);
                const data = await response.json();
                return data.results || [];
            } catch (error) {
                console.error('Error fetching classic movies:', error);
                return [];
            }
        }

        // Fetch movies by genre
        async function fetchGenreMovies(genreId, page = 1) {
            const url = `${BASE_URL}/discover/movie?api_key=${API_KEY}&with_genres=${genreId}&sort_by=popularity.desc&page=${page}&vote_count.gte=50`;
            
            try {
                const response = await fetch(url);
                const data = await response.json();
                return data.results || [];
            } catch (error) {
                console.error('Error fetching genre movies:', error);
                return [];
            }
        }

        // Display movies in container
        function displayMovies(movies, containerId, append = false) {
            const container = document.getElementById(containerId);
            if (!append) {
                container.innerHTML = '';
            }
            
            movies.forEach(movie => {
                container.innerHTML += createMovieCard(movie);
            });
        }

        // Initialize page
        async function initializePage() {
            // Load trending movies
            const trendingMovies = await fetchTrendingMovies();
            displayMovies(trendingMovies.slice(0, 8), 'trendingMovies');
            
            // Load classic movies
            const classicMovies = await fetchClassicMovies();
            displayMovies(classicMovies.slice(0, 8), 'classicMovies');
            
            // Load default genre (Action)
            const genreMovies = await fetchGenreMovies(currentGenre);
            displayMovies(genreMovies.slice(0, 8), 'genreMovies');

            // Setup event listeners
            setupEventListeners();
        }

        // Setup event listeners
        function setupEventListeners() {
            // Mood card click handlers
            document.querySelectorAll('.mood-card').forEach(card => {
                card.addEventListener('click', async () => {
                    const mood = card.dataset.mood;
                    currentMood = mood;
                    currentMoodPage = 1;
                    
                    // Update active state
                    document.querySelectorAll('.mood-card').forEach(c => c.classList.remove('active'));
                    card.classList.add('active');
                    
                    // Show mood section
                    document.getElementById('moodMoviesSection').style.display = 'block';
                    document.getElementById('moodTitle').textContent = `${card.querySelector('h4').textContent} Movies`;
                    
                    // Fetch and display movies
                    const movies = await fetchMoodMovies(mood);
                    displayMovies(movies, 'moodMovies');
                    
                    // Scroll to mood movies
                    document.getElementById('moodMoviesSection').scrollIntoView({ behavior: 'smooth' });
                });
            });

            // Genre button click handlers
            document.querySelectorAll('.genre-btn').forEach(btn => {
                btn.addEventListener('click', async () => {
                    const genreId = btn.dataset.genre;
                    currentGenre = genreId;
                    currentGenrePage = 1;
                    
                    // Update active state
                    document.querySelectorAll('.genre-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    
                    // Fetch and display movies
                    const movies = await fetchGenreMovies(genreId);
                    displayMovies(movies, 'genreMovies');
                });
            });

            // Load more buttons
            document.getElementById('loadMoreMood').addEventListener('click', async () => {
                if (currentMood) {
                    currentMoodPage++;
                    const movies = await fetchMoodMovies(currentMood, currentMoodPage);
                    displayMovies(movies, 'moodMovies', true);
                }
            });

            document.getElementById('loadMoreTrending').addEventListener('click', async () => {
                currentTrendingPage++;
                const movies = await fetchTrendingMovies(currentTrendingPage);
                displayMovies(movies, 'trendingMovies', true);
            });

            document.getElementById('loadMoreClassics').addEventListener('click', async () => {
                currentClassicsPage++;
                const movies = await fetchClassicMovies(currentClassicsPage);
                displayMovies(movies, 'classicMovies', true);
            });

            document.getElementById('loadMoreGenre').addEventListener('click', async () => {
                currentGenrePage++;
                const movies = await fetchGenreMovies(currentGenre, currentGenrePage);
                displayMovies(movies, 'genreMovies', true);
            });
        }

        // Start the page
        document.addEventListener('DOMContentLoaded', initializePage);
    </script>
</body>
</html>
